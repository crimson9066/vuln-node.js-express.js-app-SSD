# semgrep-rules/auth.yaml
rules:
- id: custom-jwt-verify-no-algorithm
  languages: [javascript]
  message: |
    Insecure JWT Verification: The jwt.verify() function is called without
    enforcing a specific algorithm in the options object. This enables the
    "none" algorithm attack, risking authentication bypass.
    (OWASP A07: Identification and Authentication Failures)
  severity: ERROR
  metadata:
    cwe: 287 # Improper Authentication
    impact: CRITICAL
    confidence: HIGH
  patterns:
    # Match jwt.verify($TOKEN, $SECRET, $OPTIONS)
  - pattern: |
      jwt.verify($TOKEN, $SECRET, $OPTIONS)
    # Match all tokens in options except those that explicitly set the 'algorithms' option
  - pattern-not: |
      $OPTIONS.algorithms = [...]
    # Ensure it's not simply missing the options object entirely
  - pattern-not: |
      jwt.verify($TOKEN, $SECRET)